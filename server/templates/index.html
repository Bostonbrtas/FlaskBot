<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    /* –¢–∞–±–ª–∏—Ü–∞ —Å–∫—Ä—ã—Ç–∞ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ */
    #employeesTable { display: none; }
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ ‚Äî —Ñ–ª–µ–∫—Å-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    #employeesCards { display: flex; flex-wrap: wrap; gap: 1em; }
    .cards-container { padding: 0; margin: 0; list-style: none; }
  </style>
</head>
<body>
  <nav class="tabs">
    <a href="{{ url_for('index') }}"    class="tab {% if active_tab=='users' %}active{% endif %}">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
    <a href="{{ url_for('projects') }}" class="tab {% if active_tab=='projects' %}active{% endif %}">–ü—Ä–æ–µ–∫—Ç—ã</a>
    <a href="{{ url_for('show_reports') }}" class="tab {% if active_tab=='reports' %}active{% endif %}">–û—Ç—á–µ—Ç—ã</a>
    <a href="{{ url_for('logout') }}" class="button delete">–í—ã–π—Ç–∏</a>
    <a href="{{ url_for('export_users') }}" class="button primary">üì§ –í—ã–≥—Ä—É–∑–∏—Ç—å –≤ Excel</a>
  </nav>

  <h1>–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h1>

  <div class="view-controls" style="margin-bottom:1em; display:flex; align-items:center; gap:1em;">
    <button onclick="location.href='{{ url_for('add_user') }}'" class="button">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
    <label>
      <input type="checkbox" id="toggleView" style="margin-right:0.5em">
      –¢–∞–±–ª–∏—á–Ω—ã–π –≤–∏–¥
    </label>
  </div>

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
  <div id="employeesCards" class="cards-container">
    {% for u in users %}
      <div class="card">
        <h2>{{ u.surname }} {{ u.name }}</h2>
        <p><strong>Telegram ID:</strong> {{ u.telegram_id }}</p>
        <a href="{{ url_for('edit_user', user_id=u.id) }}" class="button">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <form action="{{ url_for('delete_user', user_id=u.id) }}" method="POST" style="display:inline;">
          <button type="submit" class="button delete">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </div>
    {% endfor %}
    {% if not users %}
      <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ -->
  <table id="employeesTable" class="report-table">
    <thead>
      <tr>
        <th>ID</th>
        <th>–§–∞–º–∏–ª–∏—è</th>
        <th>–ò–º—è</th>
        <th>Telegram ID</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr>
        <td>{{ u.id }}</td>
        <td>{{ u.surname }}</td>
        <td>{{ u.name }}</td>
        <td>{{ u.telegram_id }}</td>
        <td>
          <a href="{{ url_for('edit_user', user_id=u.id) }}" class="btn-edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          <form action="{{ url_for('delete_user', user_id=u.id) }}" method="POST" style="display:inline;">
            <button type="submit" class="btn-delete">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
          </form>
        </td>
      </tr>
      {% endfor %}
      {% if not users %}
      <tr><td colspan="5">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–∫–∞ –Ω–µ—Ç.</td></tr>
      {% endif %}
    </tbody>
  </table>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.getElementById('toggleView');
      const cards  = document.getElementById('employeesCards');
      const table  = document.getElementById('employeesTable');

      // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±–æ—Ä –∏–∑ localStorage
      if (localStorage.getItem('employeesView') === 'table') {
        toggle.checked = true;
        cards.style.display = 'none';
        table.style.display = 'table';
      }

      toggle.addEventListener('change', () => {
        if (toggle.checked) {
          cards.style.display = 'none';
          table.style.display = 'table';
          localStorage.setItem('employeesView', 'table');
        } else {
          table.style.display = 'none';
          cards.style.display = 'flex';
          localStorage.setItem('employeesView', 'cards');
        }
      });
    });
  </script>
</body>
</html>