<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ–µ–∫—Ç—ã</title>
  <!-- –≤–∞—à –≥–ª–∞–≤–Ω—ã–π CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ */
    #projectsTable { display: none; }
    /* –∫–∞—Ä—Ç–æ—á–∫–∏ ‚Äî —Ñ–ª–µ–∫—Å-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
    #projectsCards { display: flex; flex-wrap: wrap; gap: 1em; }
    .cards-container { padding: 0; margin: 0; list-style: none; }
    /* —á—Ç–æ–±—ã –∫–∞—Ä—Ç–æ—á–∫–∏ –±—ã–ª–∏ —Å–ª–µ–≤–∞ */
    #projectsCards .card { flex: 0 0 30%; }
  </style>
</head>
<body>

  <nav class="tabs">
    <a href="{{ url_for('index') }}"    class="tab {% if active_tab=='users'    %}active{% endif %}">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
    <a href="{{ url_for('projects') }}" class="tab {% if active_tab=='projects' %}active{% endif %}">–ü—Ä–æ–µ–∫—Ç—ã</a>
    <a href="{{ url_for('show_reports') }}" class="tab {% if active_tab=='reports'%}active{% endif %}">–û—Ç—á—ë—Ç—ã</a>
    <a href="{{ url_for('logout') }}"        class="button delete">–í—ã–π—Ç–∏</a>
    <a href="{{ url_for('export_projects') }}" class="button primary">üì§ –í—ã–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç—ã</a>
  </nav>

  <h1>üìã –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤</h1>

  <div class="view-controls" style="margin-bottom:1em; display:flex; align-items:center; gap:1em;">
    <button onclick="location.href='{{ url_for('add_project') }}'" class="button">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
    <label>
      <input type="checkbox" id="toggleView" style="margin-right:0.5em">
      –¢–∞–±–ª–∏—á–Ω—ã–π –≤–∏–¥
    </label>
  </div>

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
  <div id="projectsCards" class="cards-container">
    {% for p in projects %}
      <div class="card p-3">
        <h2>{{ p.name or '(–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)' }}</h2>
        <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ p.address or '(–Ω–µ —É–∫–∞–∑–∞–Ω)' }}</p>
        <p><strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> {{ p.latitude }}, {{ p.longitude }}</p>
        <p>
          <input type="checkbox" disabled {% if p.ask_location %}checked{% endif %}>
          –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é
        </p>
        <a href="{{ url_for('edit_project', project_id=p.id) }}" class="button">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <form action="{{ url_for('delete_project', project_id=p.id) }}" method="POST" style="display:inline;">
          <button type="submit" class="button delete" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?')">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </div>
    {% else %}
      <p>–ü—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endfor %}
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ -->
  <table id="projectsTable" class="report-table">
    <thead>
      <tr>
        <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
        <th>–ê–¥—Ä–µ—Å</th>
        <th>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</th>
        <th>–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è</th>
        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      {% for p in projects %}
        <tr>
          <td>{{ p.name or '(–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è)' }}</td>
          <td>{{ p.address or '(–Ω–µ —É–∫–∞–∑–∞–Ω)' }}</td>
          <td>{{ p.latitude }}, {{ p.longitude }}</td>
          <td><input type="checkbox" disabled {% if p.ask_location %}checked{% endif %}></td>
          <td>
            <a href="{{ url_for('edit_project', project_id=p.id) }}" class="btn-edit">‚úèÔ∏è</a>
            <form action="{{ url_for('delete_project', project_id=p.id) }}" method="POST" style="display:inline;">
              <button type="submit" class="btn-delete" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?')">‚ùå</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="5">–ü—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.getElementById('toggleView');
      const cards  = document.getElementById('projectsCards');
      const table  = document.getElementById('projectsTable');

      // –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—à–ª—ã–π –≤—ã–±–æ—Ä
      if (localStorage.getItem('projectsView') === 'table') {
        toggle.checked = true;
        cards.style.display = 'none';
        table.style.display = 'table';
      }

      toggle.addEventListener('change', () => {
        if (toggle.checked) {
          cards.style.display = 'none';
          table.style.display = 'table';
          localStorage.setItem('projectsView', 'table');
        } else {
          table.style.display = 'none';
          cards.style.display = 'flex';
          localStorage.setItem('projectsView', 'cards');
        }
      });
    });
  </script>
</body>
</html>