<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—Ä–æ–µ–∫—Ç—ã</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    #projectsTable { display: none; }
    #projectsCards { display: flex; flex-wrap: wrap; gap: 1em; }
    .cards-container { padding: 0; margin: 0; list-style: none; }
  </style>
</head>
<body>
  <nav class="tabs">
    <a href="{{ url_for('index') }}"    class="tab {% if active_tab=='users' %}active{% endif %}">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
    <a href="{{ url_for('projects') }}" class="tab {% if active_tab=='projects' %}active{% endif %}">–ü—Ä–æ–µ–∫—Ç—ã</a>
    <a href="{{ url_for('show_reports') }}" class="tab {% if active_tab=='reports' %}active{% endif %}">–û—Ç—á–µ—Ç—ã</a>
    <a href="{{ url_for('logout') }}" class="button delete">–í—ã–π—Ç–∏</a>
    <a href="{{ url_for('export_projects') }}" class="button primary">üì• –í—ã–≥—Ä—É–∑–∏—Ç—å –≤ Excel</a>
  </nav>

  <h1>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤</h1>

  <div class="view-controls" style="margin-bottom:1em; display:flex; align-items:center; gap:1em;">
    <button onclick="location.href='{{ url_for('add_project') }}'" class="button">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
    <label>
      <input type="checkbox" id="toggleView" style="margin-right:0.5em">
      –¢–∞–±–ª–∏—á–Ω—ã–π –≤–∏–¥
    </label>
  </div>

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
  <div id="projectsCards" class="cards-container">
    {% for p in projects %}
      <div class="card">
        <h2>{{ p.city }}, {{ p.street }}</h2>
        <p><strong>–°—Ç—Ä–æ–µ–Ω–∏–µ:</strong> {{ p.building }}</p>
        <p><strong>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> {{ p.latitude }}, {{ p.longitude }}</p>
        <a href="{{ url_for('edit_project', project_id=p.id) }}" class="button">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <form action="{{ url_for('delete_project', project_id=p.id) }}" method="POST" style="display:inline;">
          <button type="submit" class="button delete">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </div>
    {% endfor %}
    {% if not projects %}
      <p>–ü—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endif %}
  </div>

  <!-- –¢–∞–±–ª–∏—Ü–∞ -->
  <table id="projectsTable" class="report-table">
    <thead>
      <tr>
        <th>ID</th><th>–ì–æ—Ä–æ–¥</th><th>–£–ª–∏—Ü–∞</th><th>–°—Ç—Ä–æ–µ–Ω–∏–µ</th>
        <th>–®–∏—Ä–æ—Ç–∞</th><th>–î–æ–ª–≥–æ—Ç–∞</th><th>–î–µ–π—Å—Ç–≤–∏—è</th>
      </tr>
    </thead>
    <tbody>
      {% for p in projects %}
      <tr>
        <td>{{ p.id }}</td>
        <td>{{ p.city }}</td>
        <td>{{ p.street }}</td>
        <td>{{ p.building }}</td>
        <td>{{ p.latitude }}</td>
        <td>{{ p.longitude }}</td>
        <td>
          <a href="{{ url_for('edit_project', project_id=p.id) }}" class="btn-edit">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
          <form action="{{ url_for('delete_project', project_id=p.id) }}" method="POST" style="display:inline;">
            <button type="submit" class="btn-delete">‚ùå –£–¥–∞–ª–∏—Ç—å</button>
          </form>
        </td>
      </tr>
      {% endfor %}
      {% if not projects %}
      <tr><td colspan="7">–ü—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</td></tr>
      {% endif %}
    </tbody>
  </table>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const toggle = document.getElementById('toggleView');
      const cards  = document.getElementById('projectsCards');
      const table  = document.getElementById('projectsTable');

      if (localStorage.getItem('projectsView') === 'table') {
        toggle.checked = true;
        cards.style.display = 'none';
        table.style.display = 'table';
      }

      toggle.addEventListener('change', () => {
        if (toggle.checked) {
          cards.style.display = 'none';
          table.style.display = 'table';
          localStorage.setItem('projectsView', 'table');
        } else {
          table.style.display = 'none';
          cards.style.display = 'flex';
          localStorage.setItem('projectsView', 'cards');
        }
      });
    });
  </script>
</body>
</html>