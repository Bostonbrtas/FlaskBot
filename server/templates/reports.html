<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û—Ç—á–µ—Ç—ã</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
   <nav class="tabs">
        <a href="{% if archive %}{{ url_for('archive_users') }}{% else %}{{ url_for('index') }}{% endif %}"
           class="tab {% if active_tab=='users'    %}active{% endif %}">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
        <a href="{% if archive %}{{ url_for('archive_projects') }}{% else %}{{ url_for('projects') }}{% endif %}"
           class="tab {% if active_tab=='projects' %}active{% endif %}">–ü—Ä–æ–µ–∫—Ç—ã</a>
        <a href="{% if archive %}{{ url_for('archive_reports') }}{% else %}{{ url_for('show_reports') }}{% endif %}"
           class="tab {% if active_tab=='reports'  %}active{% endif %}">–û—Ç—á–µ—Ç—ã</a>

        <a href="{{ url_for('logout') }}" class="button delete">–í—ã–π—Ç–∏</a>

        <div class="header-actions">
          {% if not archive %}
            <a href="{{ url_for('export_' ~ active_tab) }}" class="button primary">üì§ –í—ã–≥—Ä—É–∑–∏—Ç—å –≤ Excel</a>
            <a href="{{ url_for('archive_' ~ active_tab) }}" class="button secondary">üì¶ –ê—Ä—Ö–∏–≤</a>
          {% else %}
            {% if active_tab=='users' %}
              <a href="{{ url_for('index') }}" class="button primary">‚Üê –ù–∞–∑–∞–¥ –∫ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</a>
            {% elif active_tab=='projects' %}
              <a href="{{ url_for('projects') }}" class="button primary">‚Üê –ù–∞–∑–∞–¥ –∫ –ü—Ä–æ–µ–∫—Ç—ã</a>
            {% elif active_tab=='reports' %}
              <a href="{{ url_for('show_reports') }}" class="button primary">‚Üê –ù–∞–∑–∞–¥ –∫ –û—Ç—á–µ—Ç—ã</a>
            {% endif %}
          {% endif %}
        </div>
    </nav>

    <div class="container">
        <h1>–û—Ç—á–µ—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h1>

        <table class="report-table">
            <thead>
                <tr>
                    <th>Telegram ID</th>
                    <th>–°–æ—Ç—Ä—É–¥–Ω–∏–∫</th>
                    <th>–û–±—ä–µ–∫—Ç</th>
                    <th>–ù–∞—á–∞–ª–æ</th>
                    <th>–ö–æ–Ω–µ—Ü</th>
                    <th>–¢–µ–∫—Å—Ç –æ—Ç—á—ë—Ç–∞</th>
                    <th>–§–æ—Ç–æ</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for report in reports %}
                <tr>
                    <td>{{ report.user.telegram_id if report.user else '‚Äî' }}</td>
                    <td>
                      {% if report.user %}
                        <a href="{{ url_for('edit_user', user_id=report.user.id) }}" class="user-link">
                          {{ report.user.surname }} {{ report.user.name }}
                        </a>
                      {% else %}
                        <span class="deleted-user">[–£–¥–∞–ª–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]</span>
                      {% endif %}
                    </td>
                   <td>
                        {% if report.project %}
                            {{ report.project.name }}
                        {% else %}
                            [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–¥–∞–ª–µ–Ω]
                        {% endif %}
                   </td>
                    <td>{{ report.start_time.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td>{{ report.end_time.strftime('%d.%m.%Y %H:%M') if report.end_time else '‚Äî' }}</td>
                    <td>{{ report.text_report or '‚Äî' }}</td>
                  <td>
                        {% if report.photo_link and report.photo_link not in ['None', '', None] %}
                            <a href="{{ report.photo_link }}" target="_blank">üìÅ –°–º–æ—Ç—Ä–µ—Ç—å —Ñ–æ—Ç–æ –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ</a>
                        {% else %}
                            <span class="no-photo">‚Äî</span>
                        {% endif %}
                   </td>
                    <td>
                      <a href="{{ url_for('edit_report', report_id=report.id) }}" class="button">‚úèÔ∏è</a>
                      <form action="{{ url_for('toggle_archive_report', report_id=report.id) }}"
                            method="POST" style="display:inline;">
                        <button type="submit" class="button secondary">üì¶ –ê—Ä—Ö–∏–≤</button>
                      </form>
                      <form action="{{ url_for('delete_report', report_id=report.id) }}"
                            method="POST" style="display:inline;">
                        <button type="submit" class="button delete">–£–¥–∞–ª–∏—Ç—å</button>
                      </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>